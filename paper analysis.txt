Monkey 1 (M1) = Clark
Monkey 2 (M2) = Betty

-----Good/Stable-----

1. use create_3d_data_structs.m to create .mat files for betty and clark containing all "good" & "stable" trials shifted to a -500ms start time. That is, 500ms before sample onset. Now new trial_info markers/triggers are contained within new .mat files and start with a 501ms sample onset (CueOnset). Also saved recording_info into new .mat files. [good_stable_trials-betty.mat & good_stable_trials-clark.mat]
[upload data files to koko for processing]

-------ERP----------
1.1. for ERP analysis, choose from only rule 1: pull out first 1001 time points as [1,500] for prestimulus, [501,1001] for stimulus. then pull out CueOffset+1 through 810ms after [1002,1811]. save variables as BehResp x Region (4 for each monkey: correctFrontal, correctParietal, incorrectFrontal, incorrectParietal). [saved 4 betty files as bettyGoodStableRule1-split_by_BehResp_and_Region.mat] [saved 4 clark files as clarkGoodStableRule1-split_by_BehResp_and_Region.mat]

["ping" artifact rejection]
1.2. plot all trials in one graph (time x voltage x BehResp) for each Monkey x Region. So that's 4 total graphs (Frontal/Parietal for M1/M2), with correct vs incorrect in each graph. Identify the outliers as trials where noise caused the voltage to go abnormally high or low. Throw out these trials entirely. Based on the graphs, it looks like +/-750 for M1 and +/-350 for M2. Any trials outside these ranges are thrown out. There were 2 trials for M1 correct frontal thrown out, 0 for M1 incorrect frontal. There were 165 trials for M1 correct parietal thrown out, 54 for M1 incorrect parietal. There were 0 trials for M2 frontal and parietal, correct and incorrect thrown out. [saved 4 revised clark files as m1GoodStableRule1PingRej-split_by_BehResp_and_Region.mat & renamed 4 original betty files as m2GoodStableRule1PingRej-split_by_BehResp_and_Region.mat]

1.3. [use full_erp.m] avg across all rule 1 trials within each BehResp x Region for each monkey [1,811] x 8 files. shift each avg to start at 0 by subtracting out the voltage of first sample from each of 8 files. plot each avg along with 0ms and 500ms event triggers in 4 separate panes for Monkey x Region with both BehResp traces shown within each pane. [saved as full.jpg and full.eps]
----------------

-----TF POWER-----

2. for TF Power analysis, choose only from rule 1: pull out first 1,001 points for prestimulus and stimulus: [1,500] for prestimulus, [501,1001] for stimulus and CueOffset+1 through 810ms [1002,1811] for delay. Do this for areas 8B, 9L, dPFC, vPFC, LIP, MIP, PEC & PG for M1. Do this for areas 6DR, 8AD, 8B, dPFC, LIP, PE, PEC & PG for M2. Save BehResp x Area for each monkey in 32 separate variables, 16/monkey, 8/BehResp. 

["ping artifact rejection]
3. Use same parameters for ping rejection as in ERP discovery phase: +/- 750 for M1 and +/- 350 for M2. Used crawler_pingRej-Area to reject trials that had any samples outside this range. For M1: there were 2 trials rejected for correct, area 8B, 98 trials rejected for correct & 36 for incorrect, area LIP, 2 trials rejected for correct, area MIP, 21 trials rejected for correct & 7 for incorrect, area PEC, 44 trials rejected for correct & 11 for incorrect, area PG. For M2: there were 0 trials rejected across all areas and BehResp. [saved 16 M1 variables as m1GoodStableRule1PingRej-split_by_BehResp_and_Area.mat saved 16 M2 variables as m2GoodStableRule1PingRej-split_by_BehResp_and_Area.mat]. Used make_nested_struct.m to change the variables into a single struct variable "monkey" with 2 elements corresponding to each monkey(1:2).behResp.rule1.area. [saved variable as mGoodStableRule1PingRej-split_by_BehResp_and_Area.mat]
https://www.mathworks.com/help/matlab/matlab_prog/generate-field-names-from-variables.html
https://www.mathworks.com/help/matlab/matlab_prog/access-data-in-nested-structures.html
https://www.mathworks.com/help/matlab/ref/getfield.html
https://blogs.mathworks.com/loren/2005/12/13/use-dynamic-field-references/

2. create analytic (time-frequency) signal using chronux for frequency bins: 2-60Hz (500ms window, 50ms step), 61-120Hz (200ms window, 20ms step), 121-180Hz (100ms window, 10ms step), 181-240Hz (50ms window, 5ms step). This will create 4 separate traces/spectrograms per trial per session per day. Save all within the same .mat file, try to append within trial cell {eg: t32}


-------Within Session----

1. Used crawler_inMem-recordingArea-per_session.m with [good_stable_trials-betty.mat & good_stable_trials-clark.mat] files. Choose from only rule 1: pull out first 1001 time points as [1,500] for prestimulus, [501,1001] for stimulus. then pull out CueOffset+1 through 810ms after [1002,1811]. Save each trial in a nested data structure of the form monkey(1-2).day(23,24).(correct,incorrect).(chan#Area). save counts in counts.xlsx. save nested variable "monkey" in file mGoodStableRule1-split_by_Day_BehResp_and_Area.mat [legacy] & mGoodStableRule1-split_by_Day_BehResp_and_Chan.mat

["ping rejection"]

2. Used pingRejNested.m in conjunction with ping_rej function to remove all pings outside the [-750,750] microvolt range for Monkey 1. This range was determined after viewing the earlier plot where all time series were graphed on top of each other. Copied the "monkey" variable as "monkeyNew" and re-wrote the areas that had pings removed. Renamed "monkeyNew" back to "monkey" and saved in file mGoodStableRule1PingRej-split_by_Day_BehResp_and_Area.mat on koko

3. Used session_erp.m function to build ERPs for each day in analysis.m. 
=======
2. Used pingRejNested.m in conjunction with ping_rej function to remove all pings outside the [-750,750] microvolt range for Monkey 1. This range was determined after viewing the earlier plot where all time series were graphed on top of each other. If a trial was found to have a ping in one channel, it was removed from all channels for that day. This ensures all channels have the same number of trials per day. The "monkey" data structure was duplicated and renamed to "monkeyNew" to hold the new ping-trimmed data. Saved counts in counts.xlsx. Renamed "monkeyNew" back to "monkey" and saved in file mGoodStableRule1PingRej-split_by_Day_BehResp_and_Area.mat [legacy] on koko & mGoodStableRule1PingRej-split_by_Day_BehResp_and_Chan.mat


["python transfer"]
1. used mat_to_python.m to break up the large m1GoodStableRule1PingRej-split_by_Day_BehResp_and_Chan.mat file into smaller .mat files: m1GoodStableRule1PingRej-split_by_Day_BehResp_and_Chan.mat contains monkey1 variable which has correct and incorrect split for monkey 1. m2FirstHalfCorrectGoodStableRule1PingRej-split_by_Day_BehResp_and_Chan.mat contains monkey2C1st which has days 1-12 correct-only for monkey 2. m2SecondHalfCorrectGoodStableRule1PingRej-split_by_Day_BehResp_and_Chan.mat contains monkey2C2nd which has days 13-24 correct-only for monkey 2. m2FirstHalfIncorrectGoodStableRule1PingRej-split_by_Day_BehResp_and_Chan.mat contains monkey2I1st which has days 1-12 incorrect-only for monkey 2. m2SecondHalfIncorrectGoodStableRule1PingRej-split_by_Day_BehResp_and_Chan.mat contains monkey2I2nd which has days 13-24 incorrect-only for monkey 2.
